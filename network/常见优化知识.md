负载均衡：

是提高可用网络基础架构的关键组件，通常用于将工作负载分布到多个服务器来提高网站应用，数据库或其他服务的性能和可靠性。

负载均衡可以处理的请求：HTTP, HTTPS, TCP, UDP

如何选择要转发的后端服务器：

1. 确保所选择的服务器能够对请求做出响应
2. 根据预先配置的规则从健康服务器池中进行选择

Note: 运行状态检查服务会定期尝试使用转发规则定义的协议和端口去连接后端服务器。如果服务器无法通过健康检查，就会从池中剔除，保证流量不会被转发到该服务器，直到再次通过健康检查为止

负载均衡算法：

* Round Robin（轮询）：为第一个请求选择列表中的第一个服务器，然后按顺序向下移动列表直到结尾，然后循环。
* Least Connections：优先选择连接数量最少的服务器，在普遍会话较长的情况下推荐使用。
* Source：根据请求源的IP的散列（hash）来选择要转发的服务器。这种方式可以一定程度上保证特定用户能连接到相同的服务器。



解决负载均衡的单点故障问题，可以将第二个负载均衡器连接到第一个上，从而形成一个集群



算法：

* 轮询法：记录初始值和服务器的顺序，然后一个一个加一就可以
* 加权轮询：加了权重
* 平滑加权轮询： 有点tricky，实现原理是根据权重挑选权重最高的服务器，再减去max，然后加回权重，继续同原理迭代
* 随机法：存一个array，通过random包获取随机出找到server
* 加权随机：假设权重为 [5, 3, 2]，你可以随机一个数，看他落在0 - 10什么范围来选取
* 最小连接数量：
* Hash
  * 使用Hash的问题，当服务器数量出现变动时，所有缓存的位置就要发生改变
  * 一致性Hash将整个hash值空间组织成一个虚拟的圆环。整个空间按顺时针方向组织，圆环的正上方是0，左边第一个点是 $2^{32} - 1$。下一步，将各个服务器使用Hash进行一个哈希，具体可以选择服务器的IP或主机名作为关键字进行Hash。然后将这些Hash完的对象分配给顺时针的第一个服务器。因为存在数据倾斜问问题，所以需要引入虚拟节点的概念。虚拟节点均匀分布在Hash环上面。